@{
    ViewBag.Title = "Pha chế theo bàn";
    Layout = "~/Views/Shared/_LayoutTools.cshtml";
}


<link href="~/Content/toolTipGoiY.css" rel="stylesheet" />
@*@Html.Raw(ViewBag.ScriptAjaxXemChiTiet)*@


<section class="content">
    <div class="container-fluid">
        <div class="block-header">
            <h2>Pha chế - Phục vụ > Tiếp nhận pha chế</h2>
        </div>
        <!-- Vertical Layout -->
        <div class="row clearfix">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card">

                    <div class="header">
                        <h2>
                            <i class="material-icons">cached</i>
                            TIẾP NHẬN PHA CHẾ THEO BÀN
                        </h2>
                    </div>

                    <div class="body">

                        <ul class="nav nav-tabs tab-col-pink" role="tablist">

                            <li role="presentation" class="active"><a href="/PhaChe/pc_PhaChetheoBan"><i class="material-icons">markunread_mailbox</i>Pha chế theo bàn</a></li>
                            <li role="presentation" class=""><a href="/PhaChe/pc_PhaCheTheoSanPham"><i class="material-icons">room_service</i>Pha chế theo sản phẩm</a></li>
                            <li role="presentation" class=""><a href="/PhaChe/pc_PhaCheTheoThoiGian"><i class="material-icons">timer</i>Pha chế theo thời gian</a></li>

                        </ul>

                        <div class="tab-content">
                            <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="table-responsive">
                                            <table class="table table-bordered table-striped table-hover js-basic-example dataTable" id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info">
                                                <thead>
                                                    <tr>
                                                        <th rowspan="1" width="20%" colspan="1">Số bàn</th>
                                                        <th rowspan="1" width="20%" colspan="1">Tiếp nhận lúc</th>
                                                        <th rowspan="1" width="20%" colspan="1">Người phục vụ</th>
                                                        <th rowspan="1" width="20%" colspan="1">Tổng tiền</th>
                                                        <th rowspan="1" width="20%" colspan="1">Chức năng</th>
                                                    </tr>
                                                </thead>
                                                <tfoot>

                                                </tfoot>
                                                <tbody id="danhSachBanOrder">
                                                    @Html.Raw(ViewBag.TableData)
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-12 col-xs-12 pull-right">
                                        <div class="pull-right" id="js-vungPhanTrang">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
        <!-- #END# Vertical Layout -->
    </div>

    <!-- Modal cho danh sách pha chế
    <div class="modal fade" id="modalPhaChe" tabindex="2" role="dialog" style="display: none;">
        <div class="modal-dialog modal-lg" style="width:90%" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="largeModalLabel">THỰC HIỆN PHA CHẾ CHO BÀN 1 - 1231</h3>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 col-lg-6">

                            <div class="card">
                                <div class="header bg-cyan">
                                    <h2>
                                        Danh mục món chờ pha chế
                                    </h2>
                                </div>
                                <div class="body table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th style="width:40%">Tên món</th>
                                                <th>Số lượng</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <img width="50px;" height="50px;" src="/images/image-gallery/1.jpg" />
                                                    <b>Cà phê đen</b>
                                                </td>
                                                <td>
                                                    4
                                                </td>
                                                <td>
                                                    <div class="btn-group">
                                                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                                            Chức năng <span class="caret"></span>
                                                        </button>
                                                        <ul class="dropdown-menu" role="menu">
                                                            <li><a href="javascript:void(0);" data-toggle="modal" data-target="#largeModal" class=" waves-effect waves-block">Xem công thức</a></li>
                                                            <li><a href="#">Pha chế</a></li>
                                                            <li><a href="#">Huỷ</a></li>
                                                        </ul>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <img width="50px;" height="50px;" src="/images/image-gallery/1.jpg" />
                                                    <b>Cà phê đen</b>
                                                </td>
                                                <td>
                                                    4
                                                </td>
                                                <td>
                                                    <div class="btn-group">
                                                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                                            Chức năng <span class="caret"></span>
                                                        </button>
                                                        <ul class="dropdown-menu" role="menu">
                                                            <li><a href="javascript:void(0);" data-toggle="modal" data-target="#modalXemCongThuc" class=" waves-effect waves-block">Xem công thức</a></li>
                                                            <li><a href="#">Pha chế</a></li>
                                                            <li><a href="#">Huỷ</a></li>
                                                        </ul>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-6">
                            <div class="card">
                                <div class="header bg-green">
                                    <h2>
                                        Danh sách các món đang pha chế
                                    </h2>
                                </div>
                                <div class="body table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th width="40%">Tên món</th>
                                                <th>Số lượng</th>
                                                <th></th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <img width="50px;" height="50px;" src="/images/image-gallery/1.jpg" />
                                                    <b>Cà phê đen Cà phê đen Cà phê đen Cà phê đen</b>
                                                </td>
                                                <td>
                                                    4
                                                </td>
                                                <td>
                                                    <button type="submit" class="btn btn-default" data-toggle="modal" data-target="#modalXemCongThuc">Xem công thức</button>
                                                </td>
                                                <td>
                                                    <button type="submit" class="btn btn-danger">Hoàn tất</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <img width="50px;" height="50px;" src="/images/image-gallery/1.jpg" />
                                                    <b>Cà phê đen Cà phê đen Cà phê đen Cà phê đen</b>
                                                </td>
                                                <td>
                                                    4
                                                </td>
                                                <td>
                                                    <button type="submit" class="btn btn-default" data-toggle="modal" data-target="#modalXemCongThuc">Xem công thức</button>
                                                </td>
                                                <td>
                                                    <button type="submit" class="btn btn-danger">Hoàn tất</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-info waves-effect" data-dismiss="modal"><i class="material-icons">add_box</i>Hoàn tất</button>
                        <button type="button" class="btn btn-default waves-effect" data-dismiss="modal"><i class="material-icons">exit_to_app</i>Đóng lại</button>
                    </div>
                </div>
            </div>
        </div>
    </div>   Modal cho danh sách pha chế -->
    <!-- Modal cho danh sách chi tiết hoá đơn
    <div class="modal fade" id="modalChiTiet" tabindex="-2" role="dialog" style="display: none;">
        <div class="modal-dialog modal-lg" style="width:90%" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="largeModalLabel">DANH SÁCH MÓN CỦA BÀN 1 - 1321</h3>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <div class="card">
                                <div class="header bg-cyan">
                                    <h2>
                                        Danh mục món cần pha chế
                                    </h2>
                                </div>
                                <div class="body table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th style="width:40%">Tên món</th>
                                                <th>Số lượng</th>
                                                <td></td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <img width="50px;" height="50px;" src="/images/image-gallery/1.jpg" />
                                                    <b>Cà phê đen</b>
                                                </td>
                                                <td>
                                                    4
                                                </td>
                                                <td>
                                                    <button type="submit" class="btn btn-default" data-toggle="modal" data-target="#modalXemCongThuc">Xem công thức</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <img width="50px;" height="50px;" src="/images/image-gallery/1.jpg" />
                                                    <b>Cà phê đen</b>
                                                </td>
                                                <td>
                                                    4
                                                </td>
                                                <td>
                                                    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#modalXemCongThuc">Xem công thức</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div class="col-md-6">
                        <div class="pull-left">
                            <label class="pull-left col-blue-grey"><i>* Ghi chú: </i></label>
                             </div>
                          </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-success waves-effect" data-toggle="modal" data-target="#modalPhaChe"><i class="material-icons">restaurant_menu</i>Tiếp nhận và pha chế ngay</button>
                            <button type="button" class="btn btn-info waves-effect" data-toggle="modal" data-target="#modalPhaChe"><i class="material-icons">check</i>Tiếp nhận</button>
                            <button type="button" class="btn btn-danger waves-effect" data-dismiss="modal"><i class="material-icons">clear</i>Từ chối</button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>  Modal cho danh sách chi tiết  -->
</section>
@Html.Raw(ViewBag.ModalChiTiet)
<!-- Modal cho danh sách chi tiết hoá đơn
<div class="modal fade" id="modalXemCongThuc" tabindex="-1" role="dialog" style="display: none;">
    <div class="modal-dialog modal-lg" style="width:90%" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="largeModalLabel">CÁC BƯỚC THỰC HIỆN PHA CHẾ CHO MÓN 001</h3>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12 col-lg-12">
                        <div class="card">
                            <div class="header bg-cyan">
                                <h2>
                                    Danh mục món cần pha chế
                                </h2>
                            </div>
                            <div class="body table-responsive">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal"><i class="material-icons">exit_to_app</i>Đóng lại</button>
                </div>
            </div>
        </div>
    </div>
</div>  Modal cho danh sách chi tiết  -->

<script>
    $(document).ready(function (event) {
        layDanhSachOrder();
    });
    function layDanhSachOrder(e) {
        AjaxLayDanhSachBanOrDer(event); //-------Lấy danh sách lần 1
        setInterval(function (e) { //-------Chờ 30s rồi lấy danh sách 1 lần
            AjaxLayDanhSachBanOrDer(e);
        }, 30000);        
    }
    //-----Script load danh sách bàn đã order
    function AjaxLayDanhSachBanOrDer(e) {
        var res = getCurrentPageInRequest();
        $.ajax({
            url: getDuongDan() + 'PhaChe/AjaxLayDanhSachBanCanPhaChe',
            data:'page='+res,
            context: this,
            dataType: 'html',
            beforeSend: function () {
            },
            success: function (data, textStatus, xhr) {
                $('#danhSachBanOrder').empty();
                $('#danhSachBanOrder').html(data.split('&&')[0]);//Đổ danh sách lên body của table
                $('#js-vungPhanTrang').empty();
                $('#js-vungPhanTrang').html(data.split('&&')[1]);//-----Hiện phân trang
                sukienOpenModalChiTiet(e);
                //------Bắt lại sự kiện click vào nút pha chế để chuyển trang
                vaoTrangCoTruyenThamSoMaHoa(e);
            },
            error: function (xhr, textStatus, errorThrown) {
                layDanhSachOrder(e);
            }
        });
    }
    function sukienOpenModalChiTiet(e) {
        $('.goiY').click(function (event) {
            var ts = $(this).attr('maBan');
            $.ajax({
                url: getDuongDan() + 'PhaChe/AjaxXemChitietHoaDon?maBan=' + ts,
                type: 'get',
                beforeSend: function () {
                    //---Sự kiện unbind không click vào item nữa
                    event.preventDefault();
                    event.stopImmediatePropagation();
                },
                success: function (data, textStatus, xhr) {
                    $('#vungChiTiet').html(data);
                    $('#modalChiTiet').modal('show');
                    vaoTrangCoTruyenThamSoMaHoa(e);
                },
                error: function (xhr, textStatus, errorThrown) {
                }
            });
            return false;
        });
    }
</script>